<app-panel-vertical>
    @if(!combat){
    <div class="combat-selection">
        <h2>Combat Selection</h2>
        @if(combatInstances){
        @for(combat of combatInstances; track combat.id){
        <app-card (click)="onJoinClicked(combat.id)"><strong>{{combat.name}}</strong>: {{combat.characters}}</app-card>
        }
        }
        @else {
        <app-loading></app-loading>
        }
        <app-button text="Create new" (clickEvent)="onCreateClicked()"></app-button>
        <app-button text="Exit" (clickEvent)="onExitClicked()"></app-button>
    </div>

    } @else {

    <app-button text="Exit combat" (clickEvent)="onExitCombatClicked()"></app-button>

    <app-character-spells-panel [character]="character!"></app-character-spells-panel>

    <div class="combat-panel">

        <div class="characters-column">
            <h3>Characters: {{combat.characters.length}}</h3>

            @for (character of combat.characters; track character.idCharacter) {
            <div class="combat-character">
                <strong>{{ character.name }}</strong>

                <app-bar
                    label="Health ( {{character.vitals.health | number:'1.2-2'}} / {{character.vitals.maxHealth | number:'1.2-2'}} )"
                    [value]="character.vitals.health" [max]="character.vitals.maxHealth" color="#e53935" />

                <app-bar
                    label="Mana ( {{character.vitals.mana | number:'1.2-2'}} / {{character.vitals.maxMana | number:'1.2-2'}} )"
                    [value]="character.vitals.mana" [max]="character.vitals.maxMana" color="#1e88e5" />

                <app-bar
                    label="Stamina ( {{character.vitals.stamina | number:'1.2-2'}} / {{character.vitals.maxStamina | number:'1.2-2'}} )"
                    [value]="character.vitals.stamina" [max]="character.vitals.maxStamina" color="#4caf50" />

                <app-bar label="Attack" [value]="character.combatAction.counter" [max]="character.combatAction.duration"
                    color="#fdd835" />
            </div>
            }
        </div>

        <div class="creatures-column">
            <h3>Creatures: {{combat.creatures.length}}</h3>

            @for (creature of combat.creatures; track creature.id) {
            <div class="combat-creature">

                <img [src]="'/assets/creatures/' + creature.icon" alt="{{ creature.name }}" />

                <div class="creature-stats">

                    <strong>{{ creature.name }}</strong>

                    <app-bar
                        label="Health ( {{creature.vitals.health | number:'1.2-2'}} / {{creature.vitals.maxHealth | number:'1.2-2'}} )"
                        [value]="creature.vitals.health" [max]="creature.vitals.maxHealth" color="#e53935" />

                    <app-bar
                        label="Mana ( {{creature.vitals.mana | number:'1.2-2'}} / {{creature.vitals.maxMana | number:'1.2-2'}} )"
                        [value]="creature.vitals.mana" [max]="creature.vitals.maxMana" color="#1e88e5" />

                    <app-bar
                        label="Stamina ( {{creature.vitals.stamina | number:'1.2-2'}} / {{creature.vitals.maxStamina | number:'1.2-2'}} )"
                        [value]="creature.vitals.stamina" [max]="creature.vitals.maxStamina" color="#4caf50" />

                    <app-bar label="Attack" [value]="creature.combatAction.counter"
                        [max]="creature.combatAction.duration" color="#fdd835" />
                </div>
            </div>
            }
        </div>
    </div>
    }
</app-panel-vertical>